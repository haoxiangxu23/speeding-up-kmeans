# 18-645 How To Write Fast Code I, Semester Project

### Host Machine
ECE008

### Sturcture of the project
The code of this project is organized as follow:
```
baseline/                          baseline code using scikit-learn k-means
  baseline.ipynb                   jupyter notebook that generates input data set, run the k-means algorithm, and evaluate performance of scikit-learn's k-means

kmeans                             our implmentation of k-means
  data/                            test data sets generated by baseline.ipynb
  Makefile                         Makefile to build the project
  kmean.c                          single thread SIMD implmentation of k-means algorithm
  kmean_par.c                      a naive implementation of parallelism, which let performance drop
  kmean_par_schdule.c              parallelize the SIMD kernel with parallel schedule and thread local copy 
  pack.h                           helper code to pack the data into desired data layout
  rdtsc.h                          helper code to measure the cycles
  kernel.h                         implementation of our SIMD kernels
  printDist.h                      helper code for debugging
```
Note that kmean.c is the single thread implementation using SIMD kernels. The performance of individual kernels can be measure in this code. kmean_par.c is a bad implementation of parallelism, we left it for comparison. kmean_par_schdule.c is the optimized parallel version. Please use it for performance evaluation.

### Run the code
Please make sure you are in /kmeans
#### 1. run the single thread SIMD implementation
```
make kmean
```
#### 2. evaluate the performance of each kernel
```
make kernel
```
#### 3. run the code with different number of threads
```
make kmean_par_schedule
```
#### 4. run the compiled code with arbitrary data set 
```
cat ./data/dataset_40k_points_16d_4C | ./kmean_par_schedule.x 5000 4 16 40000 16
```
16 threads brings the best performance for our implementation

### Generate your own data set
Please refer to the jupyter notebook, and use simialr code to generate data set. Then manually transform it to the format of data set in ./data. The input data set should begin with *p* lines, each line represent 1 point of *p* points, followed by *c* lines represent *c* cenetrs. 

### Correctness Check
The single thread implementation will print the output automatically. To verrify the correctness of multi-thread verison, use:
```
make correctness
```
The data set we verfiy correctness is *dataset_40k_points_16d* and the standard output is in *result_dataset_40k_points_16d*

### Requirements
Restricted by the kernel size, the number of points must be a multiple of 8, number of dimensions must be a multiple of 4, and the number of centers must be a multiple of 4.